<!DOCTYPE html>
<!-- Ð¡Ñ‚Ñ€Ð°Ð½Ð¸Ñ†Ð° Ñ Ð³Ð¸ÑÑ‚Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð¾Ð¹ -->
<html lang="ru">

<head>
  <link rel="stylesheet" href="../../assets/css/main.css">
  <link rel="stylesheet" href="./histogram.css">
  <script src="../../assets/js/utils.js"></script>
  <title>Histogram</title>
  <style>
    body { padding: var(--sp-64); }

    .presentation {
      display: grid;
      gap: 1rem;
    }
  </style>
</head>

<body class="__dev-grid _off">
  <div class="presentation">
    <!-- ÐšÐ°Ðº Ð² Ð¼Ð°ÐºÐµÑ‚Ðµ: -->
    <div class="histogram">
      <div class="histogram__info">
        <label class="histogram__label">Total orders</label>
        <p class="histogram__value">50254</p>
        <button class="histogram__action">View all</button>
      </div>
      <div class="histogram__chart">
        <div class="histogram__column" style="height: 10%"></div>
        <div class="histogram__column" style="height: 20%"></div>
        <div class="histogram__column" style="height: 30%"></div>
        <div class="histogram__column" style="height: 40%"></div>
        <div class="histogram__column" style="height: 11%"></div>
        <div class="histogram__column" style="height: 14%"></div>
        <div class="histogram__column" style="height: 16%"></div>
        <div class="histogram__column" style="height: 18%"></div>
        <div class="histogram__column" style="height: 20%"></div>
        <div class="histogram__column" style="height: 40%"></div>
        <div class="histogram__column" style="height: 60%"></div>
        <div class="histogram__column" style="height: 80%"></div>
        <div class="histogram__column" style="height: 22%"></div>
        <div class="histogram__column" style="height: 24%"></div>
        <div class="histogram__column" style="height: 26%"></div>
        <div class="histogram__column" style="height: 28%"></div>
        <div class="histogram__column" style="height: 30%"></div>
        <div class="histogram__column" style="height: 40%"></div>
        <div class="histogram__column" style="height: 50%"></div>
        <div class="histogram__column" style="height: 60%"></div>
        <div class="histogram__column" style="height: 33%"></div>
        <div class="histogram__column" style="height: 36%"></div>
        <div class="histogram__column" style="height: 39%"></div>
        <div class="histogram__column" style="height: 41%"></div>
        <div class="histogram__column" style="height: 12%"></div>
        <div class="histogram__column" style="height: 16%"></div>
        <div class="histogram__column" style="height: 18%"></div>
        <div class="histogram__column" style="height: 81%"></div>
        <div class="histogram__column" style="height: 61%"></div>
        <div class="histogram__column" style="height: 21%"></div>
      </div>
    </div>

    <!--
    /* Ð Ñ‡Ñ‚Ð¾ ÐµÑÐ»Ð¸ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ð¹ Ð±ÑƒÐ´ÐµÑ‚ Ð½Ðµ Ñ‚Ð°Ðº Ð¼Ð½Ð¾Ð³Ð¾?
     * Ð¢ÐµÑÑ‚ Ð¼Ð¾Ð´Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€Ð° .histogram__chart_alt
     * Ð¥Ð¾Ñ‚ÐµÐ»Ð¾ÑÑŒ, Ñ‡Ñ‚Ð¾ Ð±Ñ‹ Ð¼Ð¾Ð´Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð±Ñ‹Ð» Ð¾Ð´Ð¸Ð½ Ð½Ð° Ð¾Ð±Ñ‰ÐµÐ¼ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ðµ Ð¸ Ð´Ð¾Ñ‡ÐµÑ€Ð½Ð¸Ðµ ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ñ‹ Ð¿Ð¾Ð¼ÐµÐ½ÑÐ»Ð¸ Ñ†Ð²ÐµÑ‚.
     * Ð’ Ñ‚Ð¾Ð¶Ðµ Ð²Ñ€ÐµÐ¼Ñ Ð´Ð»Ñ Ð¾Ð´Ð½Ð¾Ð³Ð¾ Ð¸Ð· ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ð¾Ð² Ð²Ð½ÑƒÑ‚Ñ€Ð¸ Ð±Ñ‹Ð» Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½ ÐµÑ‰Ðµ Ð¼Ð¾Ð´Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ .histogram__column_critical
     */
        -->
    <div class="histogram">
      <div class="histogram__info">
        <label class="histogram__label">Total orders</label>
        <p class="histogram__value">502</p>
        <button class="histogram__action">View all</button>
      </div>
      <div class="histogram__chart histogram__chart_alt">
        <div class="histogram__column histogram__column_critical" style="height: 10%"></div>
        <div class="histogram__column" style="height: 20%"></div>
        <div class="histogram__column" style="height: 30%"></div>
        <div class="histogram__column" style="height: 50%"></div>
        <div class="histogram__column" style="height: 80%"></div>
        <div class="histogram__column" style="height: 100%"></div>
        <div class="histogram__column" style="height: 80%"></div>
        <div class="histogram__column" style="height: 50%"></div>
      </div>
    </div>
    <!--
    /* Ð Ñ‡Ñ‚Ð¾ ÐµÑÐ»Ð¸ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ð¹ Ð±ÑƒÐ´ÐµÑ‚ Ð¼Ð°Ð»Ð¾?
     * Ð¢ÐµÑÑ‚ Ð¼Ð¾Ð´Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€Ð° .histogram__column_critical
     */
    -->
    <div class="histogram">
      <div class="histogram__info">
        <label class="histogram__label">Total orders</label>
        <p class="histogram__value">50</p>
        <button class="histogram__action">View all</button>
      </div>
      <div class="histogram__chart">
        <div class="histogram__column" style="height: 33%"></div>
        <div class="histogram__column histogram__column_critical" style="height: 67%"></div>
      </div>
    </div>

    <!--
      /* Ð Ñ‡Ñ‚Ð¾ ÐµÑÐ»Ð¸ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ð¹ Ð±ÑƒÐ´ÐµÑ‚ Ð¾Ñ‡ÐµÐ½ÑŒ Ð¼Ð½Ð¾Ð³Ð¾?
      * Ð•ÑÐ»Ð¸ ÑÐ¶Ð°Ñ‚ÑŒ ÑÐºÑ€Ð°Ð½, Ñ‚Ð¾ Ð³Ð¸ÑÑ‚Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð° Ð¿Ð¾ÐµÐ´ÐµÑ‚ Ð²Ð»ÐµÐ²Ð¾, Ð° Ð½Ðµ Ð² Ð¿Ñ€Ð°Ð²Ð¾.
      * Ð¾ÑÑ‚Ð°Ð²Ð»ÑÑ Ð¿Ñ€ÐµÐ´Ð¿Ð¾Ð»Ð¾Ð¶Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð°ÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ Ð²ÑÐµÐ³Ð´Ð° Ð² Ð²Ð¸Ð´Ð¸Ð¼Ð¾Ð¹ Ð¾Ð±Ð»Ð°ÑÑ‚Ð¸ ÑÐ¿Ñ€Ð°Ð²Ð°.
      * .upd:
      * ÐÐµ Ð°ÐºÑƒÑ‚Ð°Ð»ÑŒÐ½Ð¾ Ñ‚ÐµÐ¿ÐµÑ€ÑŒ
      * Ð°ÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ð¹ ÑÑ„Ñ„ÐµÐºÑ‚ ÑÐ¼. ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚:a026d26e04c82f98d23439c2b853259b1e89ae21
      * direction: rtl/ltr, flex-direction: row-reverse
      */
    -->
    <div class="histogram" animated>
      <div class="histogram__info">
        <label class="histogram__label">Total orders</label>
        <p class="histogram__value">5025450254</p>
        <button class="histogram__action">View all</button>
      </div>
      <div class="histogram__chart">
        <div class="histogram__column" style="height: 10%"></div>
        <div class="histogram__column" style="height: 10%"></div>
        <div class="histogram__column" style="height: 30%"></div>
        <div class="histogram__column" style="height: 40%"></div>
        <div class="histogram__column" style="height: 11%"></div>
        <div class="histogram__column" style="height: 14%"></div>
        <div class="histogram__column" style="height: 16%"></div>
        <div class="histogram__column" style="height: 18%"></div>
        <div class="histogram__column" style="height: 20%"></div>
        <div class="histogram__column" style="height: 40%"></div>
        <div class="histogram__column" style="height: 60%"></div>
        <div class="histogram__column" style="height: 80%"></div>
        <div class="histogram__column" style="height: 10%"></div>
        <div class="histogram__column" style="height: 10%"></div>
        <div class="histogram__column" style="height: 10%"></div>
        <div class="histogram__column" style="height: 10%"></div>
        <div class="histogram__column" style="height: 10%"></div>
        <div class="histogram__column" style="height: 10%"></div>
        <div class="histogram__column" style="height: 10%"></div>
        <div class="histogram__column" style="height: 10%"></div>
        <div class="histogram__column" style="height: 10%"></div>
        <div class="histogram__column" style="height: 10%"></div>
        <div class="histogram__column" style="height: 10%"></div>
        <div class="histogram__column" style="height: 10%"></div>
        <div class="histogram__column" style="height: 10%"></div>
        <div class="histogram__column" style="height: 10%"></div>
        <div class="histogram__column" style="height: 10%"></div>
        <div class="histogram__column" style="height: 10%"></div>
        <div class="histogram__column" style="height: 61%"></div>
        <div class="histogram__column" style="height: 21%"></div>
        <div class="histogram__column" style="height: 10%"></div>
        <div class="histogram__column" style="height: 20%"></div>
        <div class="histogram__column" style="height: 30%"></div>
        <div class="histogram__column" style="height: 40%"></div>
        <div class="histogram__column" style="height: 11%"></div>
        <div class="histogram__column" style="height: 14%"></div>
        <div class="histogram__column" style="height: 16%"></div>
        <div class="histogram__column" style="height: 18%"></div>
        <div class="histogram__column" style="height: 20%"></div>
        <div class="histogram__column" style="height: 40%"></div>
        <div class="histogram__column" style="height: 60%"></div>
        <div class="histogram__column" style="height: 80%"></div>
        <div class="histogram__column" style="height: 22%"></div>
        <div class="histogram__column" style="height: 24%"></div>
        <div class="histogram__column" style="height: 26%"></div>
        <div class="histogram__column" style="height: 28%"></div>
        <div class="histogram__column" style="height: 30%"></div>
        <div class="histogram__column" style="height: 40%"></div>
        <div class="histogram__column" style="height: 50%"></div>
        <div class="histogram__column" style="height: 60%"></div>
        <div class="histogram__column" style="height: 33%"></div>
        <div class="histogram__column" style="height: 36%"></div>
        <div class="histogram__column" style="height: 39%"></div>
        <div class="histogram__column" style="height: 41%"></div>
        <div class="histogram__column" style="height: 12%"></div>
        <div class="histogram__column" style="height: 16%"></div>
        <div class="histogram__column" style="height: 18%"></div>
        <div class="histogram__column" style="height: 81%"></div>
        <div class="histogram__column" style="height: 61%"></div>
        <div class="histogram__column" style="height: 21%"></div>
        <div class="histogram__column" style="height: 10%"></div>
        <div class="histogram__column" style="height: 20%"></div>
        <div class="histogram__column" style="height: 30%"></div>
        <div class="histogram__column" style="height: 40%"></div>
        <div class="histogram__column" style="height: 11%"></div>
        <div class="histogram__column" style="height: 14%"></div>
        <div class="histogram__column" style="height: 16%"></div>
        <div class="histogram__column" style="height: 18%"></div>
        <div class="histogram__column" style="height: 20%"></div>
        <div class="histogram__column" style="height: 40%"></div>
        <div class="histogram__column" style="height: 60%"></div>
        <div class="histogram__column" style="height: 80%"></div>
        <div class="histogram__column" style="height: 22%"></div>
        <div class="histogram__column" style="height: 24%"></div>
        <div class="histogram__column" style="height: 26%"></div>
        <div class="histogram__column" style="height: 28%"></div>
        <div class="histogram__column" style="height: 30%"></div>
        <div class="histogram__column" style="height: 40%"></div>
        <div class="histogram__column" style="height: 50%"></div>
        <div class="histogram__column" style="height: 60%"></div>
        <div class="histogram__column" style="height: 33%"></div>
        <div class="histogram__column" style="height: 36%"></div>
        <div class="histogram__column" style="height: 39%"></div>
        <div class="histogram__column" style="height: 41%"></div>
        <div class="histogram__column" style="height: 12%"></div>
        <div class="histogram__column" style="height: 16%"></div>
        <div class="histogram__column" style="height: 18%"></div>
        <div class="histogram__column" style="height: 81%"></div>
        <div class="histogram__column" style="height: 61%"></div>
        <div class="histogram__column" style="height: 21%"></div>
        <div class="histogram__column" style="height: 10%"></div>
        <div class="histogram__column" style="height: 20%"></div>
        <div class="histogram__column" style="height: 30%"></div>
        <div class="histogram__column" style="height: 40%"></div>
        <div class="histogram__column" style="height: 11%"></div>
        <div class="histogram__column" style="height: 14%"></div>
        <div class="histogram__column" style="height: 16%"></div>
        <div class="histogram__column" style="height: 18%"></div>
        <div class="histogram__column" style="height: 20%"></div>
        <div class="histogram__column" style="height: 40%"></div>
        <div class="histogram__column" style="height: 60%"></div>
        <div class="histogram__column" style="height: 80%"></div>
        <div class="histogram__column" style="height: 22%"></div>
        <div class="histogram__column" style="height: 24%"></div>
        <div class="histogram__column" style="height: 26%"></div>
        <div class="histogram__column" style="height: 28%"></div>
        <div class="histogram__column" style="height: 30%"></div>
        <div class="histogram__column" style="height: 40%"></div>
        <div class="histogram__column" style="height: 50%"></div>
        <div class="histogram__column" style="height: 60%"></div>
        <div class="histogram__column" style="height: 33%"></div>
        <div class="histogram__column" style="height: 36%"></div>
        <div class="histogram__column" style="height: 39%"></div>
        <div class="histogram__column" style="height: 41%"></div>
        <div class="histogram__column" style="height: 12%"></div>
        <div class="histogram__column" style="height: 16%"></div>
        <div class="histogram__column" style="height: 18%"></div>
        <div class="histogram__column" style="height: 81%"></div>
        <div class="histogram__column" style="height: 61%"></div>
        <div class="histogram__column" style="height: 21%"></div>
      </div>
    </div>

  </div>
  <script>
    (function() {
      "use strict";
      const {
        qs, cl, insert, px, int, stl,
        getAttr, setAttr, remAttr,
        getCmpStl, rndMinMaxInt: rrr,
      } = window.utils;
      const { values } = Object;
      const getIntHeight = el => int(stl(el, 'height'));
      const setRndHeight = el => stl(el, 'height', `${rrr(1, 100)}%`);
      class Histogram {
        /* elements*/
        elRoot = null;
        elValue = null;
        elChart = null;
        elButton = null;
        elValueTmp = null;
        elColumns = [];

        /* props */
        timerOmg = null;
        timer = null;
        timeout = rrr(250, 1250);

        total = 0;

        static elements = [];

        constructor(el) {
          this.elRoot = el;
          this.elValue = qs('.histogram__value', el);
          this.elButton = qs('.histogram__action', el);
          this.elChart = qs('.histogram__chart', el);
          this.elColumns = [...qs('.histogram__column', this.elChart, 'querySelectorAll')];

          this.elValueTmp = document.createElement('p');

          cl
            (this.elValueTmp, 'histogram__value', 'add')
            (this.elValueTmp, 'histogram__value_ghost', 'add');

          insert(this.elValueTmp, this.elValue.parentNode);
          this.elButton.addEventListener('click', _ => this.omg());
          this.loop();
        }

        isRun() { return !(getAttr(this.elRoot, 'animated') === null); }
        party() {
          this.elColumns.forEach(el => {
            setRndHeight(el);
            if (getIntHeight(el) > rrr(85, 99)) cl(el, 'histogram__column_critical', 'add');
            else if (getIntHeight(el) < rrr(1, 10)) cl(el, 'histogram__column_critical', 'add');
            else cl(el, 'histogram__column_critical', 'remove');
          });
        }
        omg() {
          clearTimeout(this.timerOmg);
          let [self, counter, t, maxTimer] = [this, 0, rrr(120, 450), rrr(3, 9)];
          const process = _ => {
            t = rrr(t, t * 2);
            if (++counter < maxTimer) {
              stl(self.elChart, 'overflow', 'visible');
              self.elColumns
              .forEach((el, i) => stl(el, 'transform',`rotate(${i % 2 === 0 ? rrr(0, 360) : 0}deg)`));
            } else {
              stl(self.elChart, 'overflow', 'hidden');
              self.elColumns
              .forEach(el => stl(el, 'transform', 'rotate(0deg)'));
              return clearTimeout(self.timerOmg);
            }
            self.timerOmg = setTimeout(process, t);
          };
          process();
        }

        updateCount() { this.elValue.innerText = this.total; }
        updateGhost() { this.elValueTmp.innerText = this.total; }

        count() {
          let aT = 150
          this.total = this.elColumns.reduce((sum, el) => (sum + getIntHeight(el)), 0) * rrr(10, 1000);

          cl(this.elValue, 'histogram__value_hide', 'add');
          this.updateGhost();
          remAttr(this.elValueTmp, 'style');
          /* ðŸ’© */
          setTimeout(_ => {
            cl(this.elValueTmp, 'histogram__value_ghostAppear', 'add');
            /* ðŸ’©ðŸ’© */
            setTimeout(_ => {
              setAttr(this.elValue, 'style', 'visibility: hidden');
              cl(this.elValue, 'histogram__value_hide', 'remove');
              /* ðŸ’©ðŸ’©ðŸ’© */
              setTimeout(_ => {
                this.updateCount();
                cl(this.elValueTmp, 'histogram__value_ghostAppear', 'remove');
                setAttr(this.elValueTmp, 'style', 'visibility: hidden');
                remAttr(this.elValue, 'style');
              }, aT * 4);
            }, aT * 4);
          }, aT);
        }

        loop() {
          let self = this;
          const process = _ => {
            if (!(self.isRun())) return clearTimeout(self.timer);
            self.party();
            self.count();
            self.timeout = rrr(600, 6000);
            self.timer = setTimeout(process, self.timeout);
          };
          process();
        }

        /* static methods */
        static init({ selector, ctx = null }) {
          [...qs(selector, ctx, 'querySelectorAll')]
          .forEach(el => this.addElement(new this(el)));
          return this;
        }

        static log() {
          console.log(this.elements);
          return this;
        }

        static addElement(el) {
          console.log('addElement', el);
          if (!el) return false;
          this.elements.push(el);
          return this;
        }
      };

      Histogram
        .init({ selector: '.histogram[animated]' })
        .log();
    })();
  </script>
</body>
</html>
